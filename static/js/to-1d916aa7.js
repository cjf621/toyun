import{d as L,r as g,j as P,i as Q,a as c,q as W,o as d,b as f,e,g as t,w as i,f as r,a0 as X,t as h,h as y,k as Y,c as x,F as Z,T as ee,a1 as oe,a2 as S,$ as se,E as _,p as te,m as ne}from"./to-f1ccf9a4.js";import{u as le}from"./to-e32cf6d6.js";import{_ as ae}from"./to-a2bb8ba5.js";import{_ as ce}from"./to-c27b6911.js";import"./to-f25a0731.js";const u=p=>(te("data-v-6005dc2d"),p=p(),ne(),p),ie={class:"head"},de={class:"name"},re={class:"card code"},_e={class:"h"},ue={class:"c"},fe={class:"debug"},pe={class:"card br"},ve={class:"h"},me=u(()=>e("span",null,"调用参数",-1)),ge={class:"c"},he={class:"card"},ye={class:"h"},ke=u(()=>e("span",null,"执行日志",-1)),we={class:"c is-border"},Ce={class:"c2"},qe={class:"row"},be=u(()=>e("div",{class:"row"},[e("span",null,"执行时间：2023-02-16 01:23:00")],-1)),xe={class:"row"},Se=u(()=>e("span",null,"执行状态：",-1)),Ve={key:0,class:"ok"},ze={key:1,class:"fail"},$e=u(()=>e("span",{style:{"margin-left":"20px"}},"耗时：",-1)),Be=u(()=>e("div",{class:"row"},"执行结果：",-1)),Ke={key:1,class:"error"},De=L({name:"cloud-func-dev"}),Ie=L({...De,setup(p){const{route:N,service:k,refs:w,setRefs:C,router:R}=le(),{browser:j}=oe(),q=g(!1),b=g(!1),v=g(!1),n=P({req:"",log:{error:"",type:0,time:0,createTime:"",result:{},request:{method:""}}}),a=g({content:""});async function V(o){q.value=!0,await k.cloud.func.info.info({id:N.query.id}).then(s=>{o||(s.content=S.get(`cloud.devCode-${s.id}`)||s.content,n.req=S.get(`cloud.devReq-${s.id}`)||se.req),a.value=s}).catch(s=>{_.error(s.message)}),q.value=!1}async function z(){b.value=!0,await w.code.formatCode(),await k.cloud.func.info.update({id:a.value.id,content:a.value.content}).then(()=>{_.success("保存成功")}).catch(o=>{_.error(o.message)}),b.value=!1}async function $(){v.value=!0,await w.req.formatCode();try{await k.cloud.func.info.invoke({id:a.value.id,content:a.value.content,...JSON.parse(n.req)}).then(o=>{n.log=o,_.success("运行成功")}).catch(o=>{n.log.time=0,_.error(o.message)})}catch(o){_.error(o==null?void 0:o.toString())}v.value=!1}function B(o,s){S.set(`cloud.${o}-${a.value.id}`,s)}function E(o){o.ctrlKey&&o.key.toLocaleLowerCase()=="s"&&(z(),o.preventDefault())}function M(o){o.ctrlKey&&o.key.toLocaleLowerCase()=="b"&&($(),o.preventDefault())}return Q(()=>{V()}),(o,s)=>{const T=c("el-icon"),m=c("el-button"),F=c("el-tooltip"),U=c("cl-flex1"),K=c("cl-editor-monaco"),D=c("el-col"),J=c("cl-code-json"),O=c("el-empty"),A=c("el-scrollbar"),G=c("el-row"),H=W("loading");return d(),f("div",{class:ee(["func-dev",{"is-mini":r(j).isMini}])},[e("div",ie,[t(T,{class:"back",onClick:r(R).back},{default:i(()=>[t(r(X))]),_:1},8,["onClick"]),e("span",de,"云函数（"+h(a.value.name)+"）",1)]),e("div",re,[e("div",_e,[t(F,{content:"重新加载函数代码,将会丢失当前未保存的编辑",effect:"light"},{default:i(()=>[t(m,{size:"small",loading:q.value,onClick:s[0]||(s[0]=l=>V(!0))},{default:i(()=>[y(" 刷新 ")]),_:1},8,["loading"])]),_:1}),t(m,{size:"small",type:"success",loading:b.value,onClick:z},{default:i(()=>[y(" 保存(S) ")]),_:1},8,["loading"]),t(U)]),e("div",ue,[t(K,{ref:r(C)("code"),height:"100%",language:"typescript",options:{fontSize:18},modelValue:a.value.content,"onUpdate:modelValue":s[1]||(s[1]=l=>a.value.content=l),onChange:s[2]||(s[2]=l=>{B("devCode",l)}),onKeydown:E},null,8,["modelValue"])])]),e("div",fe,[t(G,null,{default:i(()=>[t(D,{sm:12,xs:24},{default:i(()=>[e("div",pe,[e("div",ve,[me,t(m,{size:"small",type:"success",loading:v.value,onClick:$},{default:i(()=>[y(" 运行(B) ")]),_:1},8,["loading"])]),e("div",ge,[t(K,{ref:r(C)("req"),height:"100%",options:{fontSize:18},modelValue:n.req,"onUpdate:modelValue":s[3]||(s[3]=l=>n.req=l),onKeydown:M,onChange:s[4]||(s[4]=l=>{B("devReq",l)})},null,8,["modelValue"])])])]),_:1}),t(D,{sm:12,xs:24},{default:i(()=>[e("div",he,[e("div",ye,[ke,t(m,{text:"",size:"small",onClick:s[5]||(s[5]=l=>{var I;return(I=r(w).logs)==null?void 0:I.open(a.value)})},{default:i(()=>[y(" 查看全部 ")]),_:1})]),e("div",we,[Y((d(),x(A,null,{default:i(()=>{var l;return[e("div",Ce,[n.log.time>0?(d(),f(Z,{key:0},[e("div",qe,[e("span",null,"执行方法："+h((l=n.log.request)==null?void 0:l.method),1)]),be,e("div",xe,[Se,n.log.type==1?(d(),f("span",Ve,"成功")):(d(),f("span",ze,"失败")),$e,e("span",null,h(n.log.time)+"ms",1)]),Be,n.log.type==1?(d(),x(J,{key:0,height:"auto","model-value":n.log.result},null,8,["model-value"])):(d(),f("div",Ke,h(n.log.error),1))],64)):(d(),x(O,{key:1,"image-size":80}))])]}),_:1})),[[H,v.value]])])])]),_:1})]),_:1})]),t(ae,{ref:r(C)("logs")},null,512)],2)}}});const Me=ce(Ie,[["__scopeId","data-v-6005dc2d"]]);export{Me as default};
