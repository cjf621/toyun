import{aH as oe,d as S,r as q,B as I,n as W,o as l,b as u,e as p,f as e,a5 as ne,a as b,t as $,F as z,c as V,w as _,cw as ie,bB as ce,g as d,cs as re,V as j,ct as ue,I as F,cx as de,cv as pe,T as X,Y as _e,E as G,j as fe,q as K,h as J,k as Q,N as ve,cy as me,z as ge,ad as ye}from"./to-6daecd4d.js";import{u as Z}from"./to-e317cdfd.js";import{u as he}from"./to-0a44f508.js";import{f as ke,a as be,_ as xe}from"./to-d2f83d2f.js";import{_ as ee}from"./to-c27b6911.js";function te(){return{space:oe("upload-space")}}const we={class:"item-video"},Ce=["src"],$e=S({name:"item-video"}),Ie=S({...$e,props:{data:Object,list:Array},setup(f,{expose:E}){const B=f,{space:v}=te(),m=q(),g=I(()=>B.data||{}),x=I(()=>g.value.progress===void 0||g.value.progress===100);function s(){var c;v.list.value.forEach(a=>{a.isPlay=g.value.id==a.id}),(c=m.value)==null||c.play()}function h(){var a;const c=v.list.value.find(r=>r.id==g.value.id);c&&(c.isPlay=!1),(a=m.value)==null||a.pause()}return W(()=>g.value.isPlay,c=>{c?s():h()}),E({play:s,pause:h,loaded:x}),(c,a)=>(l(),u("div",we,[p("video",{ref_key:"Video",ref:m,src:e(g).url},null,8,Ce)]))}});const Ve=ee(Ie,[["__scopeId","data-v-27da804f"]]),Ee={class:"item-file__wrap"},Be=["onContextmenu"],De={key:0,class:"item-file__error"},Se={class:"image-error"},Ne={key:2,class:"item-file__name"},je={class:"item-file__actions"},ze={class:"item-file__progress-bar"},Me={class:"item-file__progress-value"},Pe={key:2,class:"item-file__index"},Oe=S({name:"item-file"}),Re=S({...Oe,props:{data:Object,list:Array},emits:["select","remove","confirm"],setup(f,{emit:E}){const B=f,{refs:v,setRefs:m}=Z(),{copy:g}=ne(),{space:x}=te(),s=I(()=>B.data||{}),h=I(()=>x.selection.value.findIndex(y=>y.id===s.value.id)),c=I(()=>h.value>=0),a=I(()=>s.value.preload||s.value.url),r=I(()=>ke(s.value.type||""));function w(){E("select",s.value)}function A(){}function M(){E("remove",s.value)}function P(){x.preview(s.value)}function D(y){_e.open(y,{hover:{target:"item-file__wrap"},list:[{label:"预览",callback(i){P(),i()}},{label:"复制链接",callback(i){s.value.url&&(g(s.value.url),G.success("复制成功")),i()}},{label:c.value?"取消选中":"选中",callback(i){w(),i()}},{label:"删除",callback(i){M(),i()}}]})}return(y,i)=>{var O,R,T;const H=b("el-image"),C=b("el-icon"),L=b("el-progress");return l(),u("div",Ee,[p("div",{class:X(["item-file",[`is-${e(s).type}`]]),onClick:i[2]||(i[2]=t=>w()),onDblclick:i[3]||(i[3]=t=>void 0),onContextmenu:j(D,["stop","prevent"])},[e(s).error?(l(),u("div",De,"上传失败："+$(e(s).error),1)):(l(),u(z,{key:1},[e(s).type==="image"?(l(),V(H,{key:0,fit:"contain",src:e(a),lazy:""},{error:_(()=>[p("div",Se,[p("span",null,$(e(a)),1)])]),_:1},8,["src"])):e(s).type==="video"?(l(),V(Ve,{key:1,ref:e(m)("video"),data:e(s),list:f.list},null,8,["data","list"])):(l(),u("span",Ne,$(e(be)(e(a)))+"."+$(e(ie)(e(a))),1)),p("span",{class:"item-file__type",style:ce({backgroundColor:(O=e(r))==null?void 0:O.color})},$((R=e(r))==null?void 0:R.label),5),p("div",je,[e(s).type=="video"?(l(),u(z,{key:0},[(T=e(v).video)!=null&&T.loaded?(l(),u(z,{key:0},[e(s).isPlay?(l(),V(C,{key:0,onClick:i[0]||(i[0]=j(t=>e(v).video.pause(),["stop"]))},{default:_(()=>[d(e(re))]),_:1})):(l(),V(C,{key:1,onClick:i[1]||(i[1]=j(t=>{var o;return(o=e(v).video)==null?void 0:o.play()},["stop"]))},{default:_(()=>[d(e(ue))]),_:1}))],64)):F("",!0)],64)):(l(),V(C,{key:1,onClick:j(P,["stop"])},{default:_(()=>[d(e(de))]),_:1},8,["onClick"])),d(C,{onClick:j(M,["stop"])},{default:_(()=>[d(e(pe))]),_:1},8,["onClick"])]),e(s).progress>0&&e(s).progress<100?(l(),u(z,{key:3},[p("div",ze,[d(L,{percentage:e(s).progress,"show-text":!1},null,8,["percentage"])]),p("span",Me,$(e(s).progress),1)],64)):F("",!0)],64)),e(c)?(l(),u("div",Pe,[p("span",null,$(e(h)+1),1)])):F("",!0)],42,Be)])}}});const Te=ee(Re,[["__scopeId","data-v-657e5df4"]]),qe={class:"cl-upload-space-inner__right"},Fe={class:"cl-upload-space-inner__header"},Ge={style:{margin:"0px 10px"}},Ae={"infinite-scroll-immediate":!1},He={key:1,class:"empty"},Le=p("p",null,"将文件拖到此处，或点击按钮上传",-1),Ue=S({name:"cl-upload-space-inner"}),Xe=S({...Ue,props:{limit:{type:Number,default:99},accept:String,selectable:Boolean},emits:["selection-change","confirm"],setup(f,{expose:E,emit:B}){const v=f,{service:m,browser:g,refs:x,setRefs:s}=Z(),{ViewGroup:h}=he({label:"分类",title:"文件列表",service:m.space.type,onEdit(){return{width:"400px",props:{labelPosition:"top"},dialog:{controls:["close"]},items:[{label:"名称",prop:"name",value:"",required:!0,component:{name:"el-input",props:{maxlength:20,clearable:!0}}}]}},onSelect(t){y({classifyId:t.id,page:1})}}),c=q(!1),a=q([]),r=q([]),w=fe({page:1,size:50,total:0});function A(){a.value=[]}function M(t){var o,n;m.space.info.add({classifyId:(n=(o=h.value)==null?void 0:o.selected)==null?void 0:n.id,...t}).then(k=>{t.id=k.id}).catch(k=>{G.error(k.message)})}function P(t){r.value.unshift(t)}const D={page:1};async function y(t){var o;A(),Object.assign(D,{type:((o=v.accept)==null?void 0:o.split("/")[0].replace("*",""))||void 0,...w,...t}),D.page==1&&(c.value=!0),await m.space.info.page(D).then(n=>{Object.assign(w,n.pagination),D.page==1&&(r.value=[]),r.value.push(...n.list)}),c.value=!1}function i(t){const o=a.value.findIndex(n=>n.id===t.id);o>=0?a.value.splice(o,1):v.limit==1?a.value=[t]:a.value.length<v.limit&&a.value.push(t)}function H(t){B("confirm",[t])}function C(t){const o=t?[t.id]:a.value.map(n=>n.id);ge.confirm("此操作将删除文件, 是否继续?","提示",{type:"warning"}).then(()=>{G.success("删除成功"),o.forEach(n=>{[r.value,a.value].forEach(k=>{const U=k.findIndex(Y=>Y.id===n);k.splice(U,1)})}),m.space.info.delete({ids:o}).catch(n=>{G.error(n.message)})}).catch(()=>null)}function L(t){x.viewer.open(t,r.value)}W(a,t=>{B("selection-change",t)},{deep:!0});function O(){r.value.length&&r.value.length<w.total&&y({page:w.page+1})}function R(t){t.preventDefault()}function T(t){t.preventDefault(),t.dataTransfer.files.forEach((o,n)=>{setTimeout(()=>{x.upload.upload(o)},n*10)})}return ye("upload-space",{selection:a,refresh:y,loading:c,list:r,preview:L}),E({selection:a,open,close,clear:A,refresh:y}),(t,o)=>{const n=b("el-button"),k=b("cl-upload"),U=b("el-icon"),Y=b("el-scrollbar"),se=b("cl-view-group"),ae=K("infinite-scroll"),le=K("loading");return l(),u("div",{class:"cl-upload-space-inner",onDragover:R,onDrop:T},[d(se,{ref_key:"ViewGroup",ref:h},{right:_(()=>[p("div",qe,[p("div",Fe,[d(n,{onClick:o[0]||(o[0]=N=>y({page:1}))},{default:_(()=>[J("刷新")]),_:1}),p("div",Ge,[d(k,{ref:e(s)("upload"),menu:"space",type:"file","show-file-list":!1,limit:f.limit,"limit-upload":!1,accept:f.accept,multiple:"",onSuccess:M,onUpload:P},{default:_(()=>[d(n,{type:"primary"},{default:_(()=>[J("点击上传")]),_:1})]),_:1},8,["limit","accept"])]),f.selectable?F("",!0):(l(),V(n,{key:0,type:"danger",disabled:a.value.length==0,onClick:o[1]||(o[1]=N=>C())},{default:_(()=>[J("删除选中文件")]),_:1},8,["disabled"]))]),Q((l(),V(Y,{class:"cl-upload-space-inner__file"},{default:_(()=>[Q((l(),u("div",Ae,[r.value.length>0?(l(),u("div",{key:0,class:X(["list",{"is-mini":e(g).isMini}])},[(l(!0),u(z,null,ve(r.value,N=>(l(),u("div",{class:"item",key:N.preload||N.url},[d(Te,{data:N,list:r.value,onConfirm:H,onSelect:i,onRemove:C},null,8,["data","list"])]))),128))],2)):(l(),u("div",He,[d(U,{class:"el-icon--upload"},{default:_(()=>[d(e(me))]),_:1}),Le]))])),[[ae,O]])]),_:1})),[[le,c.value]])])]),_:1},512),d(xe,{ref:e(s)("viewer")},null,512)],32)}}});export{Xe as _};
