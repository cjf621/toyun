import{d as v,A as R,B as W,C as j,i as G,D as H,a as l,o as r,b as g,g as p,w as o,h,f as y,F as I,G as J,H as K,c as m,I as q,J as Q,K as X,y as Y,L as Z,x as ee,M as te,q as ne,e as oe,t as V,N as le,O as ae,P as re,k as pe}from"./to-dbebbab1.js";import{s as se}from"./to-bb2e4cdf.js";import{u as N}from"./to-4abe4e3d.js";import{u as ie}from"./to-f2f81299.js";import"./to-862de5a8.js";const ce=v({name:"menu-create"}),ue=v({...ce,setup(T){const{service:u,mitt:k}=N(),x=ie(),_=R(),d=[],b=W(()=>j(d.map(s=>s.value)));function A(){var s;(s=_.value)==null||s.open({title:"快速创建",width:"800px",items:[{prop:"module",label:"选择模块",span:10,component:{name:"cl-select",props:{filterable:!0,clearable:!0,placeholder:"请选择模块",allowCreate:!0,defaultFirstOption:!0,options:J.dirs}},required:!0},{prop:"entity",label:"数据结构",span:14,component:{name:"slot-entity"},required:!0},{prop:"name",label:"菜单名称",span:10,component:{name:"el-input",props:{placeholder:"请输入菜单名称"}},required:!0},{prop:"router",label:"菜单路由",span:14,component:{name:"el-input",props:{placeholder:"请输入菜单路由，如：/test"}}},{prop:"parentId",label:"上级节点",component:{name:"cl-menu-select",props:{type:1}}},{prop:"keepAlive",value:!0,label:"路由缓存",component:{name:"el-radio-group",options:[{label:"开启",value:!0},{label:"关闭",value:!1}]}},{prop:"icon",label:"菜单图标",component:{name:"cl-menu-icon"}},{prop:"orderNum",label:"排序号",component:{name:"el-input-number",props:{placeholder:"请填写排序号",min:0,max:99,"controls-position":"right"}}},{prop:"isCreateFile",label:"是否创建文件",value:1,component:{name:"el-radio-group",options:[{label:"是",value:1},{label:"否",value:0}]}}],on:{submit(i,{done:e,close:t}){const{api:a,prefix:c,columns:w}=d.find(f=>f.value==i.entity.join("/"));x.create({...i,router:i.router,module:i.module,prefix:c,api:a,columns:w}).then(f=>{i.isCreateFile&&f(),k.emit("magic.createMenu"),t()}).catch(()=>{e()})}}})}function F(s){var e;const i=d.find(t=>t.value==s.join("/"));i&&((e=_.value)==null||e.setForm("router",`/${i.value}`))}return G(()=>{u.base.open.eps().then(s=>{for(const i in s)s[i].forEach(e=>{H(e.columns)||d.push({value:e.prefix.substring(7),...e})})})}),(s,i)=>{const e=l("el-button"),t=l("el-cascader"),a=l("cl-form");return r(),g(I,null,[p(e,{type:"success",onClick:A},{default:o(()=>[h("快速创建")]),_:1}),p(a,{ref_key:"Form",ref:_},{"slot-entity":o(({scope:c})=>[p(t,{modelValue:c.entity,"onUpdate:modelValue":w=>c.entity=w,filterable:"",separator:".",options:y(b),onChange:F},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1},512)],64)}}}),me=v({name:"auto-menu"}),de=v({...me,setup(T){const{router:u}=N();function k(){u.push("/magic/ai-code")}return(x,_)=>{const d=l("el-button");return r(),g(I,null,[y(K)?(r(),m(ue,{key:0})):q("",!0),p(d,{icon:y(Q),onClick:k},{default:o(()=>[h("Ai 极速编码")]),_:1},8,["icon"])],64)}}}),_e={key:1},be={key:1},fe=v({name:"sys-menu"}),ge=v({...fe,setup(T){const{service:u,mitt:k}=N(),{menu:x}=X(),_=Y({contextMenu:[e=>({label:"新增",hidden:!(e.type!=2&&u.base.sys.user._permission.add),callback(t){s(e),t()}}),"update","delete",e=>({label:"添加权限",hidden:!(e.type==1&&u.base.sys.user._permission.add),callback(t){i(e),t()}})],columns:[{type:"selection"},{prop:"name",label:"名称",align:"left",width:200,fixed:"left"},{prop:"icon",label:"图标",width:80},{prop:"type",label:"类型",width:100,dict:[{label:"目录",value:0},{label:"菜单",value:1,type:"success"},{label:"权限",value:2,type:"danger"}]},{prop:"router",label:"节点路由",minWidth:160},{prop:"keepAlive",label:"路由缓存",width:100},{prop:"viewPath",label:"文件路径",minWidth:200,showOverflowTooltip:!0},{prop:"perms",label:"权限",headerAlign:"center",minWidth:300},{prop:"orderNum",label:"排序号",width:90,fixed:"right"},{prop:"updateTime",label:"更新时间",sortable:"custom",width:160},{label:"操作",type:"op",width:250,buttons:["slot-add","edit","delete"]}]}),d=Z({dialog:{width:"800px"},items:[{prop:"type",value:0,label:"节点类型",required:!0,component:{name:"el-radio-group",options:[{label:"目录",value:0},{label:"菜单",value:1},{label:"权限",value:2}]}},{prop:"name",label:"节点名称",component:{name:"el-input"},required:!0},{prop:"parentId",label:"上级节点",hook:"empty",component:{name:"slot-parentId"}},{prop:"router",label:"节点路由",hidden:({scope:e})=>e.type!=1,component:{name:"el-input",props:{placeholder:"请输入节点路由，如：/test"}}},{prop:"keepAlive",value:!0,label:"路由缓存",hidden:({scope:e})=>e.type!=1,component:{name:"el-radio-group",options:[{label:"开启",value:!0},{label:"关闭",value:!1}]}},{prop:"isShow",label:"是否显示",value:!0,hidden:({scope:e})=>e.type==2,flex:!1,component:{name:"el-switch"}},{prop:"viewPath",label:"文件路径",hidden:({scope:e})=>e.type!=1,component:{name:"cl-menu-file"}},{prop:"icon",label:"节点图标",hidden:({scope:e})=>e.type==2,component:{name:"cl-menu-icon"}},{prop:"orderNum",label:"排序号",component:{name:"el-input-number",props:{placeholder:"请填写排序号",min:0,max:99,"controls-position":"right"}}},{prop:"perms",label:"权限",hidden:({scope:e})=>e.type!=2,component:{name:"cl-menu-perms"}}],plugins:[se("name")]}),b=ee({service:u.base.sys.menu,onRefresh(e,{render:t}){u.base.sys.menu.list().then(a=>{a.map(c=>{c.permList=c.perms?c.perms.split(","):[]}),t(te(a)),x.get()})}},e=>{e.refresh()});function A(e){var t;(t=b.value)==null||t.refresh(e)}function F(e,t){var a;t!=null&&t.property&&e.children&&((a=_.value)==null||a.toggleRowExpansion(e))}function s({type:e,id:t}){var a;(a=b.value)==null||a.rowAppend({parentId:t,parentType:e,type:e+1,keepAlive:!0,isShow:!0})}function i({id:e}){var t;(t=b.value)==null||t.rowAppend({parentId:e,type:2})}return k.on("magic.createMenu",A),(e,t)=>{const a=l("cl-refresh-btn"),c=l("cl-add-btn"),w=l("cl-multi-delete-btn"),f=l("cl-row"),U=l("el-tag"),M=l("cl-svg"),$=l("el-link"),B=l("el-icon"),D=l("el-button"),E=l("cl-table"),P=l("cl-menu-select"),S=l("cl-upsert"),L=l("cl-crud"),z=ne("permission");return r(),m(L,{ref_key:"Crud",ref:b},{default:o(()=>[p(f,null,{default:o(()=>[p(a),p(c),p(w),p(de)]),_:1}),p(f,null,{default:o(()=>[p(E,{ref_key:"Table",ref:_,"row-key":"id",onRowClick:F},{"column-name":o(({scope:n})=>[oe("span",null,V(n.row.name),1),n.row.isShow?q("",!0):(r(),m(U,{key:0,effect:"dark",type:"danger",size:"small","disable-transitions":"",style:{"margin-left":"10px"}},{default:o(()=>[h("隐藏")]),_:1}))]),"column-icon":o(({scope:n})=>[p(M,{name:n.row.icon,size:"16px",style:{"margin-top":"5px"}},null,8,["name"])]),"column-perms":o(({scope:n})=>[(r(!0),g(I,null,le(n.row.permList,(C,O)=>(r(),m(U,{key:O,effect:"plain",size:"small",style:{margin:"2px","letter-spacing":"0.5px"}},{default:o(()=>[h(V(C),1)]),_:2},1024))),128))]),"column-router":o(({scope:n})=>[n.row.type==1?(r(),m($,{key:0,type:"success",href:n.row.router},{default:o(()=>[h(V(n.row.router),1)]),_:2},1032,["href"])):(r(),g("span",_e,V(n.row.router),1))]),"column-keepAlive":o(({scope:n})=>[n.row.type==1?(r(),m(B,{key:0},{default:o(()=>[n.row.keepAlive?(r(),m(y(ae),{key:0})):(r(),m(y(re),{key:1}))]),_:2},1024)):(r(),g("span",be))]),"slot-add":o(({scope:n})=>[pe((r(),m(D,{type:"success",text:"",bg:"",onClick:C=>s(n.row)},{default:o(()=>[h("新增")]),_:2},1032,["onClick"])),[[z,{and:[y(u).base.sys.menu.permission.add,n.row.type!=2]}]])]),_:1},512)]),_:1}),p(S,{ref_key:"Upsert",ref:d},{"slot-parentId":o(({scope:n})=>[p(P,{modelValue:n.parentId,"onUpdate:modelValue":C=>n.parentId=C,type:n.type},null,8,["modelValue","onUpdate:modelValue","type"])]),_:1},512)]),_:1},512)}}});export{ge as default};
