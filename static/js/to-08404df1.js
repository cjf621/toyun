import{d as T,u as R,r as a,ai as Z,j as $,i as q,L as G,B as H,a4 as K,E as Q,y as X,Z as Y,x as ee,a as l,o as i,b as u,g as e,w as s,e as m,F as C,N as oe,bB as le,T as te,t as ae}from"./to-6daecd4d.js";import{u as x}from"./to-e317cdfd.js";import{l as d,v as S}from"./to-4d9e1c9c.js";import{u as se}from"./to-0405b573.js";import"./to-d91d3910.js";import"./to-d5b99870.js";const ne={class:"console"},ce=T({name:"task-task"}),ve=T({...ce,setup(re){R();const n=a(!1),j=a([]),_=a([]),M=a([]);let V=a(0);const b=["hsla(211,92%,81%,1)","hsla(211,82%,71%,1)","hsla(211,92%,51%,1)","hsla(211,82%,61%,1)"],A=()=>{n.value=!1,f()},f=()=>{M.value=[],j.value=[],_.value=[],V.value=0};Z(()=>{f()});const{service:v,refs:pe,setRefs:B,router:ie}=x();$({term:null,fitAddon:null,dialogVisible:!1}),q(()=>{d.config({paths:{vs:"https://cdn.bootcdn.net/ajax/libs/monaco-editor/0.37.1/min/vs/"}}),d.config({"vs/nls":{availableLanguages:{"*":"zh-cn"}}}),d.init().then(o=>{window.toeditor=o})});const g=G({dialog:{title:H(()=>{var o;return((o=g.value)==null?void 0:o.mode)=="add"?"新建脚本":"编辑"})},items:[{prop:"name",label:"任务名称",component:{name:"el-input"}},{prop:"remark",label:"备注",component:{name:"el-input",props:{type:"textarea",rows:2}}},{prop:"status",label:"状态",component:{name:"cl-switch"}},,{checkPerm:"add",prop:"type",label:"类型",component:{name:"el-radio-group",options:[{label:"用户",value:0},{label:"系统",color:"#67C23A",value:1}]}},{prop:"data",label:"数据",component:{name:"cl-editor-monaco",props:{language:"javascript",lib:["","ext.js"]},ref:B("monaco")}}],async onOpened(){},async onSubmit(o,{next:t}){t({...o})}}),L=K({items:[{label:"状态",prop:"type",component:{name:"el-select",props:{clearable:!1},options:[{label:"普通",value:0},{label:"系统",value:1}]}}]}),{mitt:h}=x(),y=se();y.onmessage(o=>{let t=JSON.parse(o),c=JSON.stringify(t.slice(1));switch(t[0]){case 1:S.api.pushMessage("my-terminal",{type:"json",content:t.slice(1)});break;case 2:Q({message:c,type:"success"});break}});const N=X({columns:[{type:"selection"},{prop:"uuid",label:"任务ID"},{prop:"createTime",label:"创建时间"},{prop:"updateTime",label:"更新时间"},{prop:"name",label:"任务名称"},{prop:"remark",label:"备注",showOverflowTooltip:!0},{prop:"jobtype",label:"类型",dict:[{value:"0:系统"},{value:"1:用户",color:"#67C23A"}]},{prop:"jobauto",label:"任务作者"},{fixed:"right",type:"op",buttons:["edit",{label:"运行",type:"primary",onClick({scope:o}){h.emit("log.show"),S.api.pushMessage("my-terminal",{type:"normal",content:'["月华祝词","part 1/1","pack 1/1","Start"]'}),h.emit("log.countadd"),y.send("To.work(2,"+o.row.id+")")}},{label:"添加",type:"danger",hidden:!Y({and:[v.tos.user.permission.week]}),onClick({scope:o}){}}]}]}),U=ee({service:v.tos.script},o=>{o.refresh()});return(o,t)=>{const c=l("cl-refresh-btn"),E=l("cl-add-btn"),k=l("cl-flex1"),O=l("cl-adv-btn"),z=l("cl-search-key"),D=l("cl-adv-search"),r=l("cl-row"),F=l("cl-table"),I=l("cl-pagination"),J=l("cl-upsert"),P=l("cl-crud"),W=l("cl-dialog");return i(),u(C,null,[e(P,{ref_key:"Crud",ref:U},{default:s(()=>[e(r,null,{default:s(()=>[e(c),e(E),e(k),e(O),e(z),m("div",null,[e(D,{ref_key:"AdvSearch",ref:L},null,512)])]),_:1}),e(r,null,{default:s(()=>[e(F,{ref_key:"Table",ref:N},null,512)]),_:1}),e(r,null,{default:s(()=>[e(k),e(I)]),_:1}),e(J,{ref_key:"Upsert",ref:g},null,512)]),_:1},512),m("div",null,[e(W,{title:"任务执行窗口",modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=p=>n.value=p),onClose:A},{default:s(()=>[m("div",ne,[(i(!0),u(C,null,oe(_.value,(p,w)=>(i(),u("p",{key:w,style:le({"background-color":b[Math.floor(Math.random()*b.length)]}),class:te(`console-line-${w%2==0?0:1}`),ref_for:!0,ref:"consoleLine"},ae(p),7))),128))])]),_:1},8,["modelValue"])])],64)}}});export{ve as default};
