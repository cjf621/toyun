import{r as Y,a2 as I,j as $,ah as P,n as R,ak as Z,E as b,d as U,al as ee,o as q,b as J,e as t,t as E,am as te,a5 as oe,A as se,i as ae,a as V,g as s,w as m,f as p,G as ne,h as C,an as le,k as x,S as w,ao as F,P as ie,O as de,D as ce,z as G,p as re,m as ue}from"./to-f1ccf9a4.js";import{u as K}from"./to-e32cf6d6.js";import{l as me,u as pe}from"./to-3fd710a2.js";import{_ as H}from"./to-c27b6911.js";import"./to-862de5a8.js";function _e(){const{route:r,router:f}=K(),v=Y(I.get("chatgpt.apiKey")||""),u=$({total_granted:0,total_used:0,loading:!1}),g=P(()=>{v.value&&(u.loading=!0,l==null||l.emit("getBalance",{apiKey:v.value}))},300);R(v,c=>{g(),I.set("chatgpt.apiKey",c)});let l;function M(c){l||(l=me("https://ai.cool-js.cloud",{transports:["websocket"]}),l&&(l.on("connect",()=>{g(),l==null||l.on("progress",_=>{var S;if(_.includes("[DONE]")){if(r.path!="/magic/ai-code"){const a=Z({title:"提示",message:"Ai自动生成代码完成，点击查看",duration:0,onClick(){f.push("/magic/ai-code"),a.close()}})}(S=c.onComplete)==null||S.call(c),g()}else try{_.split("data: ").forEach(a=>{var e;if(a){const n=JSON.parse(a),{content:N=""}=n.choices[0].delta;(e=c==null?void 0:c.onMessage)==null||e.call(c,N)}})}catch{}}),l==null||l.on("balance",_=>{_=="error apiKey"?(b.error(_),u.total_granted=0,u.total_used=0):(u.total_granted=_.total_granted.toFixed(5),u.total_used=_.total_used.toFixed(5)),u.loading=!1})}),l.on("disconnect",_=>{})))}function k(c){l==null||l.emit("data",c)}return{connect:M,send:k,apiKey:v,balance:u,getBalance:g}}function fe(){const{mitt:r}=K();let f;function v(){u(),f=setInterval(()=>{r.emit("view.scrollTo",{top:Math.random()+1e4})},100)}function u(){f&&clearInterval(f)}return{start:v,stop:u}}const ve={class:"text-stage"},ge={class:"wrapper"},he=te('<div class="slash" data-v-a0f669c6></div><div class="sides" data-v-a0f669c6><div class="side" data-v-a0f669c6></div><div class="side" data-v-a0f669c6></div><div class="side" data-v-a0f669c6></div><div class="side" data-v-a0f669c6></div></div>',2),ye={class:"text"},Ve={class:"text--backing"},Ce={class:"text--left"},xe={class:"inner"},we={class:"text--right"},be={class:"inner"},ze=U({name:"undefined"}),Se=U({...ze,props:{fontSize:{type:String,default:"30px"},color:{type:String,default:"#000000"},modelValue:String},setup(r){return ee(f=>({ae47e94a:r.fontSize})),(f,v)=>(q(),J("div",ve,[t("div",ge,[he,t("div",ye,[t("div",Ve,E(r.modelValue),1),t("div",Ce,[t("div",xe,E(r.modelValue),1)]),t("div",we,[t("div",be,E(r.modelValue),1)])])])]))}});const $e=H(Se,[["__scopeId","data-v-a0f669c6"]]),z=r=>(re("data-v-c4f36185"),r=r(),ue(),r),ke={class:"ai-code"},Ee={class:"container"},Ie={class:"head"},Ue={class:"form"},Me=z(()=>t("div",{class:"label required"},"CRUD",-1)),Ne={class:"row"},Te=z(()=>t("div",{class:"label"},"其他你想做的事？",-1)),Be={class:"btns"},De=z(()=>t("div",{class:"tips"},"如遇见 “代码缺失”、“请求超时”，请尝试「刷新」吧",-1)),Fe={class:"codes"},Ke={class:"item is-entity"},je={class:"label"},Ae={class:"name"},Oe=z(()=>t("span",null,"Entity（实体类）",-1)),Ge={class:"item is-controller"},Pe={class:"label"},Re={class:"name"},qe=z(()=>t("span",null,"Controller（控制层）",-1)),Je={class:"item is-vue"},He={class:"label"},Le={class:"name"},Qe=z(()=>t("span",null,"Vue（页面）",-1)),We={class:"op"},Xe=z(()=>t("div",{class:"bottom"},null,-1)),Ye=U({name:"magic-ai-code"}),Ze=U({...Ye,setup(r){const{service:f,mitt:v,refs:u,setRefs:g}=K(),{copy:l}=oe(),M=pe(),k=_e(),c=fe(),_=se(),S=$({options:{fontSize:16}}),a=$(I.get("ai-create.form")||{name:"收货地址",module:"user",other:"",columns:["用户ID","联系人","手机号","省市区","地址","是否默认"]}),e=$({disabled:!1,coding:"",message:[],path:"",columns:[],api:[{path:"/add",summary:"新增"},{path:"/info",summary:"单个信息"},{path:"/update",summary:"修改"},{path:"/delete",summary:"删除"},{path:"/page",summary:"分页查询"},{path:"/list",summary:"列表查询"}]}),n=$({entity:"",controller:"",vue:""});function N(){if(!a.module)return b.warning("请选择模块");if(!a.name)return b.warning("请填写实体名称");if(ce(a.columns))return b.warning("请填写字段");function d(){j(),e.disabled=!0,k.send(a),c.start()}e.message.length?G.confirm("此操作将重新生成代码，是否继续？","提示",{type:"warning"}).then(()=>{d()}).catch(()=>null):d()}function j(){e.disabled=!1,e.message=[],e.coding="",n.entity="",n.controller="",n.vue=""}function T(d){l(n[d]),b.success("复制成功")}function L(){return b.error("只有在开发环境下才有效")}function Q(){const d=e.message.join("").split("```").map(o=>o.replace(`typescript
`,""));d[1]&&(e.coding="entity",n.entity=d[1]),d[3]&&(e.coding="controller",n.controller=d[3])}const A=P(d=>{async function o(){if(e.disabled)return!1;n.entity&&(e.coding="vue",await f.base.sys.menu.parse({entity:n.entity,controller:n.controller,module:a.module}).then(async h=>{e.path=h.path,e.columns=h.columns,n.vue=M.createVue({router:e.path.replace("/admin",""),prefix:e.path,api:e.api,columns:e.columns,module:a.module}),setTimeout(()=>{u.codeVue.formatCode(),v.emit("view.scrollTo",{el:".codes .is-vue"})},300)}).catch(h=>{b.error(h.message)}),e.coding="")}d?o():G.confirm("此操作将会重新生成vue代码，是否继续？","提示",{type:"warning"}).then(()=>{o()}).catch(()=>null)},300);return R(()=>a,d=>{I.set("ai-create.form",d)}),ae(()=>{k.connect({onMessage(d){e.message.push(d),Q()},onComplete(){e.disabled=!1,c.stop(),A(!0)}})}),(d,o)=>{const h=V("cl-select"),O=V("el-input"),W=V("el-form"),y=V("el-button"),B=V("el-icon"),D=V("cl-editor"),X=V("cl-form");return q(),J("div",ke,[t("div",Ee,[t("div",Ie,[s($e,{"model-value":" Ai 极速编码"})]),t("div",Ue,[s(W,{disabled:e.disabled},{default:m(()=>[Me,t("div",Ne,[s(h,{class:"module",placeholder:"请选择模块",size:"large",modelValue:a.module,"onUpdate:modelValue":o[0]||(o[0]=i=>a.module=i),options:p(ne).dirs,"label-key":"name","value-key":"name","allow-create":""},null,8,["modelValue","options"]),s(O,{class:"name",modelValue:a.name,"onUpdate:modelValue":o[1]||(o[1]=i=>a.name=i),placeholder:"实体名称，如：收货地址"},null,8,["modelValue"]),s(h,{class:"columns",size:"large",multiple:"","allow-create":"",modelValue:a.columns,"onUpdate:modelValue":o[2]||(o[2]=i=>a.columns=i),"default-first-option":"",placeholder:"请填写字段，多个按回车。如：姓名、年龄、状态"},null,8,["modelValue"])]),Te,s(O,{type:"textarea",modelValue:a.other,"onUpdate:modelValue":o[3]||(o[3]=i=>a.other=i),rows:5,placeholder:"如：分页查询时姓名、手机号字段设置成可模糊搜索"},null,8,["modelValue"])]),_:1},8,["disabled"])]),t("div",Be,[s(y,{round:"",size:"large",type:"primary",icon:p(le),disabled:e.disabled,loading:e.disabled,onClick:N},{default:m(()=>[C(E(e.disabled?"思考中":e.message.length?"重新生成":"下一步"),1)]),_:1},8,["icon","disabled","loading"])]),De,t("div",Fe,[x(t("div",Ke,[t("div",je,[t("div",Ae,[Oe,x(s(B,{class:"is-loading"},{default:m(()=>[s(p(F))]),_:1},512),[[w,e.coding=="entity"]])]),s(y,{round:"",size:"small",onClick:o[4]||(o[4]=i=>T("entity"))},{default:m(()=>[C("Copy")]),_:1}),s(y,{round:"",type:"success",size:"small",onClick:o[5]||(o[5]=i=>p(A)())},{default:m(()=>[C(" 生成Vue代码 ")]),_:1})]),s(D,{name:"cl-editor-monaco",ref:p(g)("codeEntity"),options:S.options,height:"auto",autofocus:"",autosize:"",language:"typescript",modelValue:n.entity,"onUpdate:modelValue":o[6]||(o[6]=i=>n.entity=i)},null,8,["options","modelValue"])],512),[[w,n.entity]]),x(t("div",Ge,[t("div",Pe,[t("div",Re,[qe,x(s(B,{class:"is-loading"},{default:m(()=>[s(p(F))]),_:1},512),[[w,e.coding=="controller"]])]),s(y,{round:"",size:"small",onClick:o[7]||(o[7]=i=>T("controller"))},{default:m(()=>[C("Copy")]),_:1})]),s(D,{name:"cl-editor-monaco",ref:p(g)("codeController"),options:S.options,height:"auto",autosize:"",language:"typescript",modelValue:n.controller,"onUpdate:modelValue":o[8]||(o[8]=i=>n.controller=i)},null,8,["options","modelValue"])],512),[[w,n.controller]]),x(t("div",Je,[t("div",He,[t("div",Le,[Qe,x(s(B,{class:"is-loading"},{default:m(()=>[s(p(F))]),_:1},512),[[w,e.coding=="vue"]])]),s(y,{round:"",size:"small",onClick:o[9]||(o[9]=i=>T("vue"))},{default:m(()=>[C("Copy")]),_:1})]),s(D,{name:"cl-editor-monaco",ref:p(g)("codeVue"),options:S.options,height:"auto",autosize:"",language:"html",modelValue:n.vue,"onUpdate:modelValue":o[10]||(o[10]=i=>n.vue=i)},null,8,["options","modelValue"])],512),[[w,n.vue]])]),x(t("div",We,[s(y,{icon:p(ie),round:"",size:"large",onClick:j},{default:m(()=>[C(" 取消 ")]),_:1},8,["icon"]),s(y,{icon:p(de),round:"",size:"large",type:"success",onClick:L},{default:m(()=>[C(" 创建文件 ")]),_:1},8,["icon"])],512),[[w,!e.disabled&&e.message.length]]),Xe]),s(X,{ref_key:"Form",ref:_},null,512)])}}});const nt=H(Ze,[["__scopeId","data-v-c4f36185"]]);export{nt as default};
