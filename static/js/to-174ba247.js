import{d as q,r as z,j as O,y as R,x as U,a as l,o as r,c as $,w as c,g as o,X,A as G,aw as J,q as K,b as h,e as p,F as E,N as P,k as T,f as i,cr as Q,T as Z,a1 as ee,E as b,p as se,m as te,t as N,h as A,cs as ne,V as S,ct as oe,cu as ae,cv as le,z as W,Y as ce}from"./to-6daecd4d.js";import{u as j}from"./to-e317cdfd.js";import{_ as ie}from"./to-c27b6911.js";const re=q({name:"undefined"}),pe=q({...re,setup(g,{expose:n}){const{service:F}=j(),m=z(!1),M=z(""),y=O({status:[{label:"成功",value:1,type:"success"},{label:"失败",value:0,type:"danger"}]}),D=R({autoHeight:!1,columns:[{label:"#",type:"index"},{label:"描述",prop:"detail",showOverflowTooltip:!0,minWidth:200},{label:"执行状态",prop:"status",minWidth:120,dict:y.status},{label:"执行时间",prop:"createTime",minWidth:160}]}),d=U({service:F.task.info,dict:{api:{page:"log"}}});function V(k){m.value=!0,M.value=`日志列表（${k.name}）`,X(()=>{var _;(_=d.value)==null||_.refresh({id:k.id,page:1})})}function B(){m.value=!1}return n({open:V,close:B}),(k,_)=>{const x=l("cl-refresh-btn"),I=l("cl-select"),Y=l("cl-filter"),s=l("cl-row"),t=l("cl-table"),e=l("cl-flex1"),u=l("cl-pagination"),C=l("cl-crud"),w=l("cl-dialog");return r(),$(w,{modelValue:m.value,"onUpdate:modelValue":_[0]||(_[0]=f=>m.value=f),title:M.value,width:"1000px"},{default:c(()=>[o(C,{ref_key:"Crud",ref:d,padding:"0"},{default:c(()=>[o(s,null,{default:c(()=>[o(x),o(Y,{label:"状态"},{default:c(()=>[o(I,{options:y.status,prop:"status"},null,8,["options"])]),_:1})]),_:1}),o(s,null,{default:c(()=>[o(t,{ref_key:"Table",ref:D},null,512)]),_:1}),o(s,null,{default:c(()=>[o(e),o(u)]),_:1})]),_:1},512)]),_:1},8,["modelValue","title"])}}}),H=g=>(se("data-v-a8d997fc"),g=g(),te(),g),de={class:"list"},ue=["onClick","onContextmenu"],_e={class:"name"},fe={class:"row"},me=H(()=>p("span",null,"执行服务",-1)),ke={class:"row"},ve=H(()=>p("span",null,"定时规则",-1)),he={class:"status"},be=H(()=>p("p",null,"添加计划任务",-1)),ge=q({name:"task-list"}),ye=q({...ge,setup(g){const{service:n,refs:F,setRefs:m}=j(),{browser:M}=ee(),y=G(),D=z([]);function d(){n.task.info.page({size:100,page:1}).then(s=>{D.value=s.list.map(t=>(t.every&&(t._every=parseInt(String(t.every/1e3))),t))})}function V(s){W.confirm(`此操作将启用任务（${s.name}），是否继续？`,"提示",{type:"warning"}).then(()=>{n.task.info.start({id:s.id,type:s.type}).then(()=>{d()}).catch(t=>{b.error(t.message)})}).catch(()=>null)}function B(s){W.confirm(`此操作将停用任务（${s.name}），是否继续？`,"提示",{type:"warning"}).then(()=>{n.task.info.stop({id:s.id}).then(()=>{d()}).catch(t=>{b.error(t.message)})}).catch(()=>null)}function k(s){W.confirm(`此操作将删除任务（${s.name}），是否继续？`,"提示",{type:"warning"}).then(()=>{n.task.info.delete({ids:[s.id]}).then(()=>{d()}).catch(t=>{b.error(t.message)})}).catch(()=>null)}function _(s){F.log.open(s)}async function x(s){var t;if(s&&!n.task.info._permission.update)return!1;(t=y.value)==null||t.open({title:"编辑计划任务",width:"600px",props:{labelWidth:"80px"},items:[{label:"名称",prop:"name",component:{name:"el-input",props:{placeholder:"请输入名称"}},required:!0},{label:"类型",prop:"taskType",value:0,component:{name:"el-radio-group",options:[{label:"cron",value:0},{label:"时间间隔",value:1}]},required:!0},{label:"cron",prop:"cron",hidden:({scope:e})=>e.taskType==1,component:{name:"el-input",props:{placeholder:"* * * * * *"}},required:!0},{label:"间隔(秒)",prop:"every",hidden:({scope:e})=>e.taskType==0,hook:{bind(e){return e/1e3},submit(e){return e*1e3}},component:{name:"el-input-number",props:{min:1,max:1e8}},required:!0},{label:"service",prop:"service",component:{name:"el-input",props:{placeholder:"taskDemoService.test([1, 2])"}}},{label:"开始时间",prop:"startDate",hidden:({scope:e})=>e.taskType==1,component:{name:"el-date-picker",props:{type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"}}},{label:"备注",prop:"remark",component:{name:"el-input",props:{type:"textarea",rows:3}}}],form:{...s},on:{submit:(e,{close:u,done:C})=>{e.limit||(e.limit=null),n.task.info[s!=null&&s.id?"update":"add"](e).then(()=>{d(),b.success("保存成功"),u()}).catch(w=>{b.error(w.message),C()})}}})}function I(s){n.task.info.once({id:s.id}).then(()=>{d()}).catch(t=>{b.error(t.message)})}function Y(s,t){ce.open(s,{list:[t.status?{label:"暂停",hidden:!n.task.info._permission.stop,callback(e){B(t),e()}}:{label:"开始",hidden:!n.task.info._permission.start,callback(e){V(t),e()}},{label:"立即执行",hidden:!n.task.info._permission.once,callback(e){I(t),e()}},{label:"编辑",hidden:!(n.task.info._permission.update&&n.task.info._permission.info),callback(e){x(t),e()}},{label:"删除",hidden:!n.task.info._permission.delete,callback(e){k(t),e()}},{label:"查看日志",hidden:!n.task.info._permission.log,callback(e){_(t),e()}}]})}return J(()=>{d()}),(s,t)=>{const e=l("el-tag"),u=l("el-icon"),C=l("cl-flex1"),w=l("cl-form"),f=K("permission");return r(),h("div",{class:Z(["task-list",{"is-mini":i(M).isMini}])},[p("div",de,[(r(!0),h(E,null,P(D.value,(a,L)=>(r(),h("div",{key:L,class:"item",onClick:v=>x(a),onContextmenu:v=>{Y(v,a)}},[p("p",_e,N(a.name),1),p("p",fe,[me,p("span",null,N(a.service),1)]),p("p",ke,[ve,p("span",null,N(a.taskType==1?`间隔${a._every}秒执行`:a.cron),1)]),p("div",he,[a.status?(r(),h(E,{key:0},[o(e,{"disable-transitions":"",effect:"dark",type:"success"},{default:c(()=>[A("进行中")]),_:1}),T((r(),$(u,{class:"pause",onClick:S(v=>B(a),["stop"])},{default:c(()=>[o(i(ne))]),_:2},1032,["onClick"])),[[f,i(n).task.info.permission.stop]])],64)):(r(),h(E,{key:1},[o(e,{"disable-transitions":"",effect:"dark",type:"danger"},{default:c(()=>[A("已停止")]),_:1}),T((r(),$(u,{class:"play",onClick:S(v=>V(a),["stop"])},{default:c(()=>[o(i(oe))]),_:2},1032,["onClick"])),[[f,i(n).task.info.permission.start]])],64)),o(C),T((r(),$(u,{class:"log",onClick:S(v=>_(a),["stop"])},{default:c(()=>[o(i(ae))]),_:2},1032,["onClick"])),[[f,i(n).task.info.permission.log]]),T((r(),$(u,{class:"delete",onClick:S(v=>k(a),["stop"])},{default:c(()=>[o(i(le))]),_:2},1032,["onClick"])),[[f,i(n).task.info.permission.delete]])])],40,ue))),128)),T((r(),h("div",{class:"item is-add",onClick:t[0]||(t[0]=a=>x())},[o(u,null,{default:c(()=>[o(i(Q))]),_:1}),be])),[[f,i(n).task.info.permission.add]])]),o(w,{ref_key:"Form",ref:y},null,512),o(pe,{ref:i(m)("log")},null,512)],2)}}});const Te=ie(ye,[["__scopeId","data-v-a8d997fc"]]);export{Te as default};
