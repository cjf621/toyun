import{d as M,u as R,r as i,ai as W,j as Z,i as $,L as q,E as G,y as H,Z as K,x as Q,a as t,o as k,b as C,g as l,w as p,e as O,F as V,N as X,aC as Y,T as ee,t as le}from"./to-dbebbab1.js";import{u as ae}from"./to-4abe4e3d.js";import{u as se}from"./to-8a5885f5.js";const te={class:"console"},oe=M({name:"task-task"}),pe=M({...oe,setup(ne){R();const d=i(!1),n=i([]),v=i([]),r=i([]);let a=i(0),m=null;const x=["hsl(211,82%,87%)","hsl(211,81%,75%)","hsla(211,81%,75%,0.83)","hsla(207,91%,61%,1)","hsla(211,92%,81%,1)","hsla(211,82%,81%,1)"],N=()=>{b(),g(),d.value=!0,L(),h("TO初始化中"),h("开始执行脚本")},w=()=>{d.value=!1,b(),g()},L=()=>{m=setInterval(()=>{var e,s,c,_;if(a.value<r.value.length){const o=r.value[a.value],f={message:o.substr(0,((e=n.value[a.value])==null?void 0:e.currentCharacterIndex)+1),currentCharacterIndex:((s=n.value[a.value])==null?void 0:s.currentCharacterIndex)+1||0};n.value[a.value]=f;const u={序号:r.value.indexOf(o.substr(0,((c=n.value[a.value])==null?void 0:c.currentCharacterIndex)+1))+1,消息:o.substr(0,((_=n.value[a.value])==null?void 0:_.currentCharacterIndex)+1)};v.value[a.value]=u,f.currentCharacterIndex>=o.length&&a.value++}else a.value,r.value.length},50)},b=()=>{m!==null&&(clearInterval(m),m=null)},g=()=>{r.value=[],n.value=[],v.value=[],a.value=0},h=e=>{r.value.push(e)};W(()=>{b(),g()});const{service:T,refs:U,setRefs:j,router:re}=ae();Z({term:null,fitAddon:null,dialogVisible:!1}),$(()=>{});const B=q({items:[{prop:"name",label:"任务名称",component:{name:"el-input"}},{prop:"remark",label:"备注",component:{name:"el-input",props:{type:"textarea",rows:2}}},{prop:"status",label:"状态",component:{name:"cl-switch"}},,{prop:"data",label:"数据",component:{name:"cl-editor-monaco",props:{language:"javascript",lib:["","ext.js"]},ref:j("monaco")}}],async onOpened(){},async onSubmit(e,{next:s}){const c=await U.monaco.formatCode();s({...e,content:c})}}),I=se();I.onmessage(e=>{let s=JSON.parse(e);switch(s[0]){case 1:h(JSON.stringify(s.slice(1)));break;case 2:w(),G({message:JSON.stringify(s.slice(1)),type:"success"});break}});const E=H({columns:[{type:"selection"},{prop:"id",label:"任务ID",sortable:"desc"},{prop:"createTime",label:"创建时间",sortable:"desc"},{prop:"updateTime",label:"更新时间",sortable:"custom"},{prop:"name",label:"任务名称"},{prop:"remark",label:"备注",showOverflowTooltip:!0},{prop:"jobauto",label:"任务作者"},{fixed:"right",type:"op",buttons:["edit",{label:"运行",type:"primary",onClick({scope:e}){N(),I.send("To.work(2,"+e.row.id+")")}},{label:"添加",type:"danger",hidden:!K({and:[T.base.seer.permission.week]}),onClick({scope:e}){}}]}]}),J=Q({service:T.work.info},e=>{e.refresh()});return(e,s)=>{const c=t("cl-refresh-btn"),_=t("cl-add-btn"),o=t("cl-flex1"),f=t("cl-search-key"),u=t("cl-row"),z=t("cl-table"),D=t("cl-pagination"),F=t("cl-upsert"),A=t("cl-crud"),P=t("cl-dialog");return k(),C(V,null,[l(A,{ref_key:"Crud",ref:J},{default:p(()=>[l(u,null,{default:p(()=>[l(c),l(_),l(o),l(f)]),_:1}),l(u,null,{default:p(()=>[l(z,{ref_key:"Table",ref:E},null,512)]),_:1}),l(u,null,{default:p(()=>[l(o),l(D)]),_:1}),l(F,{ref_key:"Upsert",ref:B},null,512)]),_:1},512),O("div",null,[l(P,{title:"任务执行窗口",modelValue:d.value,"onUpdate:modelValue":s[0]||(s[0]=y=>d.value=y),onClose:w},{default:p(()=>[O("div",te,[(k(!0),C(V,null,X(v.value,(y,S)=>(k(),C("p",{key:S,style:Y({"background-color":x[Math.floor(Math.random()*x.length)]}),class:ee(`console-line-${S%2==0?0:1}`),ref_for:!0,ref:"consoleLine"},le(y),7))),128))])]),_:1},8,["modelValue"])])],64)}}});export{pe as default};
