import{d as x,r as m,A as G,y as S,a3 as B,x as A,M as I,a as n,o as v,c as O,w as a,h as _,t as d,g as o,f as U,b as J,N as K,F as L}from"./to-6daecd4d.js";import{u as W}from"./to-e317cdfd.js";import{u as $}from"./to-0a44f508.js";import{i as H}from"./to-d5b99870.js";const P=x({name:"job-list"}),le=x({...P,setup(Q){const k=["flash","h5"],b=m(["flash"]),{service:c,refs:X,setRefs:g}=W(),C=G();m();const f=m(),h=S({columns:[{type:"selection"},{prop:"name",label:"任务名称"},{prop:"conf",label:"配置"},{label:"任务类型",prop:"jobtype",dict:[{label:"h5",value:1,type:"success"},{label:"flash",value:0,type:"danger"}]},{prop:"limit",label:"限制次数"},{prop:"remark",label:"备注",showOverflowTooltip:!0},{label:"状态",prop:"status",dict:[{label:"执行中",value:1,type:"success"},{label:"未执行",value:0,type:"danger"}]},{prop:"startDate",label:"开始时间",component:{name:"cl-date-text",props:{format:"YYYY-MM-DD"}}},{prop:"endDate",label:"结束时间",component:{name:"cl-date-text",props:{format:"YYYY-MM-DD"}}},{type:"op",width:260,buttons:["edit",{label:"配置",type:"warning",onClick({scope:e}){var t;(t=C.value)==null||t.open({title:"云任务配置",items:[{label:"次数",prop:"name1",value:e.row.limit,required:!0,component:{name:"el-input",props:{placeholder:"请输入次数",type:"number"}}},{label:"类型",prop:"name3",value:f,required:!1,component:{name:"el-switch",props:{placeholder:"请输入参数","active-text":"h5","inactive-text":"flash"}}},{label:"参数",prop:"name2",value:f,required:!1,component:{name:"el-input",props:{placeholder:"请输入参数",autosize:"{ minRows: 2, maxRows: 4 }",type:"textarea"}}}],on:{submit(l,{close:p,done:w}){e.row.limit=l.name1,e.row.conf=l.name2,e.row.jobtype=l.name3,p()}}})}},{label:"执行",type:"success",onClick({scope:e}){JSON.parse(localStorage.getItem("account")).forEach(l=>{c.job.list.start({name:e.row.name,id:l,count:e.row.limit,type:e.row.jobtype,conf:e.row.conf}).then(p=>{H.addbop(l,e.row.name,p)})})}}]}]});B();const{ViewGroup:j}=$({label:"类型",title:"云任务列表",service:c.job.type,onSelect(e){D({type:e.id,page:1})},onEdit(){return{width:"500px",props:{labelWidth:"60px"},items:[{label:"名称",prop:"name",component:{name:"el-input",props:{maxlength:20}},required:!0},{label:"Key",prop:"key",component:{name:"el-input",props:{maxlength:20}},required:!0}]}}}),i=A({service:c.job.list,onRefresh(e,{render:t}){c.job.list.list({...e,page:void 0,size:void 0}).then(l=>{t(I(l,e.sort))})}});function D(e){var t;(t=i.value)==null||t.refresh(e)}function V(e,t){var l;t!=null&&t.property&&e.children&&((l=h.value)==null||l.toggleRowExpansion(e))}function Y(e){var t;(t=i.value)==null||t.rowAppend({parentId:e.id,orderNum:1})}return(e,t)=>{const l=n("cl-refresh-btn"),p=n("cl-add-btn"),w=n("cl-multi-delete-btn"),y=n("cl-flex1"),R=n("cl-search-key"),u=n("cl-row"),T=n("el-button"),q=n("cl-table"),M=n("el-checkbox-button"),N=n("el-checkbox-group"),z=n("cl-upsert"),E=n("cl-crud"),F=n("cl-view-group");return v(),O(F,{ref_key:"ViewGroup",ref:j},{"item-name":a(({item:s})=>[_(d(s.name)+" - "+d(s.key),1)]),right:a(()=>[o(E,{ref_key:"Crud",ref:i},{default:a(()=>[o(u,null,{default:a(()=>[o(l),o(p),o(w),o(y),o(R,{placeholder:"搜索名称"})]),_:1}),o(u,null,{default:a(()=>[o(q,{ref_key:"Table",ref:h,"row-key":"id",onRowClick:V},{"slot-btn":a(({scope:s})=>[o(T,{text:"",bg:"",type:"success",onClick:r=>Y(s.row)},{default:a(()=>[_("新增")]),_:2},1032,["onClick"])]),_:1},512)]),_:1}),o(u,null,{default:a(()=>[o(y)]),_:1}),o(z,{ref:"Upsert"},{"slot-name":a(({scope:s})=>[o(N,{ref:U(g)("type"),modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=r=>b.value=r),size:"large"},{default:a(()=>[(v(),J(L,null,K(k,r=>o(M,{key:r,label:r},{default:a(()=>[_(d(r),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1},512)]),_:1},512)]),_:1},512)}}});export{le as default};
